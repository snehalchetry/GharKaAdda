// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id            String    @id @default(cuid())
  name          String
  email         String    @unique
  phone         String
  password      String
  role          String    // "student" | "owner"
  status        String    @default("pending") // "pending" | "verified" | "rejected"
  collegeId     String?
  collegeIdImage String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  listings      Listing[]
  reviews       Review[]
  sentMessages  ChatMessage[] @relation("SentMessages")
  receivedMessages ChatMessage[] @relation("ReceivedMessages")
  studentChats  Chat[] @relation("StudentChats")
  ownerChats    Chat[] @relation("OwnerChats")
}

model Listing {
  id              String    @id @default(cuid())
  title           String
  description     String
  images          String    // JSON array of image URLs
  rent            Int
  deposit         Int
  location        String
  latitude        Float
  longitude       Float
  amenities       String    // JSON array
  hasAC           Boolean   @default(false)
  mealsIncluded   Boolean   @default(false)
  genderPreference String   @default("any") // "male" | "female" | "any"
  ownerId         String
  owner           User      @relation(fields: [ownerId], references: [id])
  verified        Boolean   @default(false)
  boosted         Boolean   @default(false)
  views           Int       @default(0)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  reviews         Review[]
  chats           Chat[]
}

model Review {
  id        String   @id @default(cuid())
  listingId String
  listing   Listing  @relation(fields: [listingId], references: [id])
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  rating    Int
  comment   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Chat {
  id        String   @id @default(cuid())
  studentId String
  student   User     @relation("StudentChats", fields: [studentId], references: [id])
  ownerId   String
  owner     User     @relation("OwnerChats", fields: [ownerId], references: [id])
  listingId String
  listing   Listing  @relation(fields: [listingId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  messages  ChatMessage[]
}

model ChatMessage {
  id         String   @id @default(cuid())
  chatId     String
  chat       Chat     @relation(fields: [chatId], references: [id])
  senderId   String
  sender     User     @relation("SentMessages", fields: [senderId], references: [id])
  receiverId String
  receiver   User     @relation("ReceivedMessages", fields: [receiverId], references: [id])
  message    String
  read       Boolean  @default(false)
  createdAt  DateTime @default(now())
}

